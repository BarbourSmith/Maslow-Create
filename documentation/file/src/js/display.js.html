<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/js/display.js | canvas-template</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#js">js</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/BOM.js~BOMEntry.html">BOMEntry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/display.js~Display.html">Display</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/globalvariables.js~GlobalVariables.html">GlobalVariables</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extractBomTags">extractBomTags</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addOrDeletePorts">addOrDeletePorts</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GitHubModule">GitHubModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-cmenu">cmenu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-globalVariables">globalVariables</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#js-molecules">js/molecules</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/BOM.js~AddBOMTag.html">AddBOMTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/assembly.js~Assembly.html">Assembly</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/box.js~Box.html">Box</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/circle.js~Circle.html">Circle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/code.js~Code.html">Code</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/color.js~Color.html">Color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/constant.js~Constant.html">Constant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/cutlayout.js~CutLayout.html">CutLayout</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/cutlist.js~CutList.html">CutList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/difference.js~Difference.html">Difference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/equation.js~Equation.html">Equation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/extracttag.js~ExtractTag.html">ExtractTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/extrude.js~Extrude.html">Extrude</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/gcode.js~Gcode.html">Gcode</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/geneticAlgorithm.js~GeneticAlgorithm.html">GeneticAlgorithm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/githubmolecule.js~GitHubMolecule.html">GitHubMolecule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/input.js~Input.html">Input</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/intersection.js~Intersection.html">Intersection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/molecule.js~Molecule.html">Molecule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/output.js~Output.html">Output</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/readme.js~Readme.html">Readme</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/rectangle.js~Rectangle.html">Rectangle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/regularPolygon.js~RegularPolygon.html">RegularPolygon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/rotate.js~Rotate.html">Rotate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/shrinkwrap.js~ShrinkWrap.html">ShrinkWrap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/stl.js~Stl.html">Stl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/svg.js~Svg.html">Svg</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/tag.js~Tag.html">Tag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/translate.js~Translate.html">Translate</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#js-prototypes">js/prototypes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/prototypes/atom.js~Atom.html">Atom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/prototypes/attachmentpoint.js~AttachmentPoint.html">AttachmentPoint</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/prototypes/connector.js~Connector.html">Connector</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/js/display.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import GlobalVariables from &apos;./globalvariables&apos;
import * as THREE from &apos;three&apos;
import { TrackballControls } from &apos;three/examples/jsm/controls/TrackballControls.js&apos;

/**
 * This class handles writing to the 3D preview display. Large parts of this class are copied directly from JSxCAD.
 */
export default class Display {
    /**
     * The constructor run to create the new display. It seems to run with each refresh which doesn&apos;t seem right to me.
     */
    constructor(){
        /** 
         * An array which contains the data to be respresented in 3D.
         * @type {array}
         */
        this.datasets = []
        /**
         *The last shape that was sent to the display. Used for switching to wireframe.
         */
        this.displayedGeometry = []
        /** 
         * An Flag to indicate if the grid on the XY plane should be displayed.
         * @type {boolean}
         */
        this.displayGrid = true
        /** 
         * Grid scale to keep track of zoom scale
         * @type {number}
         */
        this.gridScale = 1
        /** 
         * A flag to indicate if the axes should be displayed.
         * @type {boolean}
         */
        this.axesCheck = true
        /** 
         * A flag to indicate if the frame should be displayed in wire frame.
         * @type {boolean}
         */
        this.wireDisplay = false
        /** 
         * A flag to indicate if the solid should be displayed.
         * @type {boolean}
         */
        this.solidDisplay = true
        /** 
         * A threejs camera instance.
         * @type {object}
         */
        this.camera
        /** 
         * A three js controls instance.
         * @type {object}
         */
        this.controls
        /** 
         * A threejs scene instance.
         * @type {object}
         */
        this.scene
        /** 
         * A threejs renderer instance.
         * @type {object}
         */
        this.renderer
        /** 
         * The applied material type.
         * @type {object}
         */
        this.mesh
        /** 
         * The HTML div object targeted to add the display to.
         * @type {object}
         */
        this.targetDiv = document.getElementById(&apos;viewerContext&apos;)
        
        /** 
         * The default material used if nothing is set
         * @type {object}
         */
        this.threeMaterial = new THREE.MeshStandardMaterial({
            color: 0x5f6670,
            roughness: 0.65,
            metalness: 0.40
        })
        
        /** 
         * A list of colors to RGB mappings.
         * @type {object}
         */
        this.colorToRgbMapping = {
            &apos;black&apos;: [70 / 255, 70 / 255, 70 / 255], // Dark gray,
            &apos;silver&apos;: [ 192 / 255, 192 / 255, 192 / 255 ],
            &apos;gray&apos;: [ 128 / 255, 128 / 255, 128 / 255 ],
            &apos;white&apos;: [ 255 / 255, 255 / 255, 255 / 255 ],
            &apos;maroon&apos;: [ 128 / 255, 0 / 255, 0 / 255 ],
            &apos;red&apos;: [ 255 / 255, 99 / 255, 71 / 255 ],
            &apos;purple&apos;: [ 128 / 255, 0 / 255, 128 / 255 ],
            &apos;fuchsia&apos;: [ 255 / 255, 0 / 255, 255 / 255 ],
            &apos;green&apos;: [ 0 / 255, 128 / 255, 0 / 255 ],
            &apos;lime&apos;: [ 0 / 255, 255 / 255, 0 / 255 ],
            &apos;olive&apos;: [ 128 / 255, 128 / 255, 0 / 255 ],
            &apos;yellow&apos;: [ 255 / 255, 255 / 255, 0 / 255 ],
            &apos;navy&apos;: [ 0 / 255, 0 / 255, 128 / 255 ],
            &apos;blue&apos;: [ 0 / 255, 0 / 255, 255 / 255 ],
            &apos;teal&apos;: [ 0 / 255, 128 / 255, 128 / 255 ],
            &apos;aqua&apos;: [ 0 / 255, 255 / 255, 255 / 255 ],
            // extended color keywords
            &apos;aliceblue&apos;: [ 240 / 255, 248 / 255, 255 / 255 ],
            &apos;antiquewhite&apos;: [ 250 / 255, 235 / 255, 215 / 255 ],
            // &apos;aqua&apos;: [ 0 / 255, 255 / 255, 255 / 255 ],
            &apos;aquamarine&apos;: [ 127 / 255, 255 / 255, 212 / 255 ],
            &apos;azure&apos;: [ 240 / 255, 255 / 255, 255 / 255 ],
            &apos;beige&apos;: [ 245 / 255, 245 / 255, 220 / 255 ],
            &apos;bisque&apos;: [ 255 / 255, 228 / 255, 196 / 255 ],
            // &apos;black&apos;: [ 0 / 255, 0 / 255, 0 / 255 ],
            &apos;blanchedalmond&apos;: [ 255 / 255, 235 / 255, 205 / 255 ],
            // &apos;blue&apos;: [ 0 / 255, 0 / 255, 255 / 255 ],
            &apos;blueviolet&apos;: [ 138 / 255, 43 / 255, 226 / 255 ],
            &apos;brown&apos;: [ 205 / 255, 133 / 255, 63 / 255 ],
            &apos;burlywood&apos;: [ 222 / 255, 184 / 255, 135 / 255 ],
            &apos;cadetblue&apos;: [ 95 / 255, 158 / 255, 160 / 255 ],
            &apos;chartreuse&apos;: [ 127 / 255, 255 / 255, 0 / 255 ],
            &apos;chocolate&apos;: [ 210 / 255, 105 / 255, 30 / 255 ],
            &apos;coral&apos;: [ 255 / 255, 127 / 255, 80 / 255 ],
            &apos;cornflowerblue&apos;: [ 100 / 255, 149 / 255, 237 / 255 ],
            &apos;cornsilk&apos;: [ 255 / 255, 248 / 255, 220 / 255 ],
            &apos;crimson&apos;: [ 220 / 255, 20 / 255, 60 / 255 ],
            &apos;cyan&apos;: [ 0 / 255, 255 / 255, 255 / 255 ],
            &apos;darkblue&apos;: [ 0 / 255, 0 / 255, 139 / 255 ],
            &apos;darkcyan&apos;: [ 0 / 255, 139 / 255, 139 / 255 ],
            &apos;darkgoldenrod&apos;: [ 184 / 255, 134 / 255, 11 / 255 ],
            &apos;darkgray&apos;: [ 169 / 255, 169 / 255, 169 / 255 ],
            &apos;darkgreen&apos;: [ 0 / 255, 100 / 255, 0 / 255 ],
            &apos;darkgrey&apos;: [ 169 / 255, 169 / 255, 169 / 255 ],
            &apos;darkkhaki&apos;: [ 189 / 255, 183 / 255, 107 / 255 ],
            &apos;darkmagenta&apos;: [ 139 / 255, 0 / 255, 139 / 255 ],
            &apos;darkolivegreen&apos;: [ 85 / 255, 107 / 255, 47 / 255 ],
            &apos;darkorange&apos;: [ 255 / 255, 140 / 255, 0 / 255 ],
            &apos;darkorchid&apos;: [ 153 / 255, 50 / 255, 204 / 255 ],
            &apos;darkred&apos;: [ 139 / 255, 0 / 255, 0 / 255 ],
            &apos;darksalmon&apos;: [ 233 / 255, 150 / 255, 122 / 255 ],
            &apos;darkseagreen&apos;: [ 143 / 255, 188 / 255, 143 / 255 ],
            &apos;darkslateblue&apos;: [ 72 / 255, 61 / 255, 139 / 255 ],
            &apos;darkslategray&apos;: [ 47 / 255, 79 / 255, 79 / 255 ],
            &apos;darkslategrey&apos;: [ 47 / 255, 79 / 255, 79 / 255 ],
            &apos;darkturquoise&apos;: [ 0 / 255, 206 / 255, 209 / 255 ],
            &apos;darkviolet&apos;: [ 148 / 255, 0 / 255, 211 / 255 ],
            &apos;deeppink&apos;: [ 255 / 255, 20 / 255, 147 / 255 ],
            &apos;deepskyblue&apos;: [ 0 / 255, 191 / 255, 255 / 255 ],
            &apos;dimgray&apos;: [ 105 / 255, 105 / 255, 105 / 255 ],
            &apos;dimgrey&apos;: [ 105 / 255, 105 / 255, 105 / 255 ],
            &apos;dodgerblue&apos;: [ 30 / 255, 144 / 255, 255 / 255 ],
            &apos;firebrick&apos;: [ 178 / 255, 34 / 255, 34 / 255 ],
            &apos;floralwhite&apos;: [ 255 / 255, 250 / 255, 240 / 255 ],
            &apos;forestgreen&apos;: [ 34 / 255, 139 / 255, 34 / 255 ],
            // &apos;fuchsia&apos;: [ 255 / 255, 0 / 255, 255 / 255 ],
            &apos;gainsboro&apos;: [ 220 / 255, 220 / 255, 220 / 255 ],
            &apos;ghostwhite&apos;: [ 248 / 255, 248 / 255, 255 / 255 ],
            &apos;gold&apos;: [ 255 / 255, 215 / 255, 0 / 255 ],
            &apos;goldenrod&apos;: [ 218 / 255, 165 / 255, 32 / 255 ],
            // &apos;gray&apos;: [ 128 / 255, 128 / 255, 128 / 255 ],
            // &apos;green&apos;: [ 0 / 255, 128 / 255, 0 / 255 ],
            &apos;greenyellow&apos;: [ 173 / 255, 255 / 255, 47 / 255 ],
            &apos;grey&apos;: [ 128 / 255, 128 / 255, 128 / 255 ],
            &apos;honeydew&apos;: [ 240 / 255, 255 / 255, 240 / 255 ],
            &apos;hotpink&apos;: [ 255 / 255, 105 / 255, 180 / 255 ],
            &apos;indianred&apos;: [ 205 / 255, 92 / 255, 92 / 255 ],
            &apos;indigo&apos;: [ 75 / 255, 0 / 255, 130 / 255 ],
            &apos;ivory&apos;: [ 255 / 255, 255 / 255, 240 / 255 ],
            &apos;khaki&apos;: [ 240 / 255, 230 / 255, 140 / 255 ],
            &apos;lavender&apos;: [ 230 / 255, 230 / 255, 250 / 255 ],
            &apos;lavenderblush&apos;: [ 255 / 255, 240 / 255, 245 / 255 ],
            &apos;lawngreen&apos;: [ 124 / 255, 252 / 255, 0 / 255 ],
            &apos;lemonchiffon&apos;: [ 255 / 255, 250 / 255, 205 / 255 ],
            &apos;lightblue&apos;: [ 173 / 255, 216 / 255, 230 / 255 ],
            &apos;lightcoral&apos;: [ 240 / 255, 128 / 255, 128 / 255 ],
            &apos;lightcyan&apos;: [ 224 / 255, 255 / 255, 255 / 255 ],
            &apos;lightgoldenrodyellow&apos;: [ 250 / 255, 250 / 255, 210 / 255 ],
            &apos;lightgray&apos;: [ 211 / 255, 211 / 255, 211 / 255 ],
            &apos;lightgreen&apos;: [ 144 / 255, 238 / 255, 144 / 255 ],
            &apos;lightgrey&apos;: [ 211 / 255, 211 / 255, 211 / 255 ],
            &apos;lightpink&apos;: [ 255 / 255, 182 / 255, 193 / 255 ],
            &apos;lightsalmon&apos;: [ 255 / 255, 160 / 255, 122 / 255 ],
            &apos;lightseagreen&apos;: [ 32 / 255, 178 / 255, 170 / 255 ],
            &apos;lightskyblue&apos;: [ 135 / 255, 206 / 255, 250 / 255 ],
            &apos;lightslategray&apos;: [ 119 / 255, 136 / 255, 153 / 255 ],
            &apos;lightslategrey&apos;: [ 119 / 255, 136 / 255, 153 / 255 ],
            &apos;lightsteelblue&apos;: [ 176 / 255, 196 / 255, 222 / 255 ],
            &apos;lightyellow&apos;: [ 255 / 255, 255 / 255, 224 / 255 ],
            // &apos;lime&apos;: [ 0 / 255, 255 / 255, 0 / 255 ],
            &apos;limegreen&apos;: [ 50 / 255, 205 / 255, 50 / 255 ],
            &apos;linen&apos;: [ 250 / 255, 240 / 255, 230 / 255 ],
            &apos;magenta&apos;: [ 255 / 255, 0 / 255, 255 / 255 ],
            // &apos;maroon&apos;: [ 128 / 255, 0 / 255, 0 / 255 ],
            &apos;mediumaquamarine&apos;: [ 102 / 255, 205 / 255, 170 / 255 ],
            &apos;mediumblue&apos;: [ 0 / 255, 0 / 255, 205 / 255 ],
            &apos;mediumorchid&apos;: [ 186 / 255, 85 / 255, 211 / 255 ],
            &apos;mediumpurple&apos;: [ 147 / 255, 112 / 255, 219 / 255 ],
            &apos;mediumseagreen&apos;: [ 60 / 255, 179 / 255, 113 / 255 ],
            &apos;mediumslateblue&apos;: [ 123 / 255, 104 / 255, 238 / 255 ],
            &apos;mediumspringgreen&apos;: [ 0 / 255, 250 / 255, 154 / 255 ],
            &apos;mediumturquoise&apos;: [ 72 / 255, 209 / 255, 204 / 255 ],
            &apos;mediumvioletred&apos;: [ 199 / 255, 21 / 255, 133 / 255 ],
            &apos;midnightblue&apos;: [ 25 / 255, 25 / 255, 112 / 255 ],
            &apos;mintcream&apos;: [ 245 / 255, 255 / 255, 250 / 255 ],
            &apos;mistyrose&apos;: [ 255 / 255, 228 / 255, 225 / 255 ],
            &apos;moccasin&apos;: [ 255 / 255, 228 / 255, 181 / 255 ],
            &apos;navajowhite&apos;: [ 255 / 255, 222 / 255, 173 / 255 ],
            // &apos;navy&apos;: [ 0 / 255, 0 / 255, 128 / 255 ],
            &apos;oldlace&apos;: [ 253 / 255, 245 / 255, 230 / 255 ],
            // &apos;olive&apos;: [ 128 / 255, 128 / 255, 0 / 255 ],
            &apos;olivedrab&apos;: [ 107 / 255, 142 / 255, 35 / 255 ],
            &apos;orange&apos;: [ 255 / 255, 165 / 255, 0 / 255 ],
            &apos;orangered&apos;: [ 255 / 255, 69 / 255, 0 / 255 ],
            &apos;orchid&apos;: [ 218 / 255, 112 / 255, 214 / 255 ],
            &apos;palegoldenrod&apos;: [ 238 / 255, 232 / 255, 170 / 255 ],
            &apos;palegreen&apos;: [ 152 / 255, 251 / 255, 152 / 255 ],
            &apos;paleturquoise&apos;: [ 175 / 255, 238 / 255, 238 / 255 ],
            &apos;palevioletred&apos;: [ 219 / 255, 112 / 255, 147 / 255 ],
            &apos;papayawhip&apos;: [ 255 / 255, 239 / 255, 213 / 255 ],
            &apos;peachpuff&apos;: [ 255 / 255, 218 / 255, 185 / 255 ],
            &apos;peru&apos;: [ 205 / 255, 133 / 255, 63 / 255 ],
            &apos;pink&apos;: [ 255 / 255, 192 / 255, 203 / 255 ],
            &apos;plum&apos;: [ 221 / 255, 160 / 255, 221 / 255 ],
            &apos;powderblue&apos;: [ 176 / 255, 224 / 255, 230 / 255 ],
            // &apos;purple&apos;: [ 128 / 255, 0 / 255, 128 / 255 ],
            // &apos;red&apos;: [ 255 / 255, 0 / 255, 0 / 255 ],
            &apos;rosybrown&apos;: [ 188 / 255, 143 / 255, 143 / 255 ],
            &apos;royalblue&apos;: [ 65 / 255, 105 / 255, 225 / 255 ],
            &apos;saddlebrown&apos;: [ 139 / 255, 69 / 255, 19 / 255 ],
            &apos;salmon&apos;: [ 250 / 255, 128 / 255, 114 / 255 ],
            &apos;sandybrown&apos;: [ 244 / 255, 164 / 255, 96 / 255 ],
            &apos;seagreen&apos;: [ 46 / 255, 139 / 255, 87 / 255 ],
            &apos;seashell&apos;: [ 255 / 255, 245 / 255, 238 / 255 ],
            &apos;sienna&apos;: [ 160 / 255, 82 / 255, 45 / 255 ],
            // &apos;silver&apos;: [ 192 / 255, 192 / 255, 192 / 255 ],
            &apos;skyblue&apos;: [ 135 / 255, 206 / 255, 235 / 255 ],
            &apos;slateblue&apos;: [ 106 / 255, 90 / 255, 205 / 255 ],
            &apos;slategray&apos;: [ 112 / 255, 128 / 255, 144 / 255 ],
            &apos;slategrey&apos;: [ 112 / 255, 128 / 255, 144 / 255 ],
            &apos;snow&apos;: [ 255 / 255, 250 / 255, 250 / 255 ],
            &apos;springgreen&apos;: [ 0 / 255, 255 / 255, 127 / 255 ],
            &apos;steelblue&apos;: [ 70 / 255, 130 / 255, 180 / 255 ],
            &apos;tan&apos;: [ 210 / 255, 180 / 255, 140 / 255 ],
            // &apos;teal&apos;: [ 0 / 255, 128 / 255, 128 / 255 ],
            &apos;thistle&apos;: [ 216 / 255, 191 / 255, 216 / 255 ],
            &apos;tomato&apos;: [ 255 / 255, 99 / 255, 71 / 255 ],
            &apos;turquoise&apos;: [ 64 / 255, 224 / 255, 208 / 255 ],
            &apos;violet&apos;: [ 238 / 255, 130 / 255, 238 / 255 ],
            &apos;wheat&apos;: [ 245 / 255, 222 / 255, 179 / 255 ],
            // &apos;white&apos;: [ 255 / 255, 255 / 255, 255 / 255 ],
            &apos;whitesmoke&apos;: [ 245 / 255, 245 / 255, 245 / 255 ],
            // &apos;yellow&apos;: [ 255 / 255, 255 / 255, 0 / 255 ],
            &apos;yellowgreen&apos;: [ 154 / 255, 205 / 255, 50 / 255 ]
        }
        
        /** 
         * A description.
         * @type {array}
         */
        this.materialProperties = {
            paper: {
                roughness: 0.5,
                metalness: 0.0,
                reflectivity: 0.5
            },
            wood: {
                roughness: 0.5,
                metalness: 0.0,
                reflectivity: 0.5
            },
            metal: {
                roughness: 0.5,
                metalness: 0.5,
                reflectivity: 0.9,
                clearCoat: 1,
                clearCoatRoughness: 0
            },
            glass: {
                roughness: 0.5,
                metalness: 0.5,
                reflectivity: 0.9,
                clearCoat: 1,
                clearCoatRoughness: 0,
                opacity: 0.5,
                transparent: true
            },
            keepout: {
                roughness: 0.5,
                metalness: 0.0,
                reflectivity: 0.0,
                opacity: 0.2,
                transparent: true
            }
        }
        
        //Add the JSXCAD window
        
        /** 
         * The camera which controls how the scene is rendered.
         * @type {object}
         */
        this.camera = new THREE.PerspectiveCamera(27, window.innerWidth / window.innerHeight, 1, 50500);
        [this.camera.position.x, this.camera.position.y, this.camera.position.z] = [0, -30, 50]
        //
        /** 
         * The controls which let the user pan and zoom with the mouse.
         * @type {object}
         */
        this.controls = new TrackballControls(this.camera, this.targetDiv)
        this.controls.rotateSpeed = 4.0
        this.controls.zoomSpeed = 4.0
        this.controls.panSpeed = 2.0
        this.controls.noZoom = false
        this.controls.noPan = false
        this.controls.staticMoving = true
        this.controls.dynamicDampingFactor = 0.1
        this.controls.keys = [65, 83, 68]
        this.controls.addEventListener(&apos;change&apos;, () =&gt; { this.render() })
        this.controls.addEventListener(&apos;change&apos;, () =&gt; { this.controls.addEventListener(&apos;change&apos;, () =&gt; { 
            this.setGrid()
        }) })
        //
        /** 
         * The threejs scene to which things should be added to show up on the display.
         * @type {object}
         */
        this.scene = new THREE.Scene()
        this.scene.background = new THREE.Color(0xFFFFFF)
        this.scene.add(this.camera)
        //
        var ambientLight = new THREE.AmbientLight(0xc9c7c7)
        this.scene.add(ambientLight)
        // var light1 = new THREE.PointLight(0xffffff, 0, 1);
        // camera.add(light1);
        var light2 = new THREE.DirectionalLight(0xd9d9d9, 1)
        light2.position.set(1, 1, 1)
        this.camera.add(light2)

        /** 
         * The three js Axes that appears on the grid
         * @type {object}
         */
        this.axesHelper = new THREE.AxesHelper( 10 )
        this.scene.add(this.axesHelper)
        this.gridLevel
        
        //
        /** 
         * The three js webGLRendere object which does the actual rendering to the screen.
         * @type {object}
         */

        this.renderer = new THREE.WebGLRenderer({ antialias: true })
        this.renderer.setPixelRatio(window.devicePixelRatio)
        this.renderer.inputGamma = true
        this.renderer.outputGamma = true
        this.targetDiv.appendChild(this.renderer.domElement)
        
        this.onWindowResize()
 
        let viewerBar = document.querySelector(&apos;#viewer_bar&apos;)
        let arrowUpMenu = document.querySelector(&apos;#arrow-up-menu&apos;)

        this.targetDiv.addEventListener(&apos;mouseenter&apos;, () =&gt; {
            if(viewerBar.innerHTML.trim().length == 0){
                this.checkBoxes()   
            }
        })

        var evtFired = false
        var g_timer

        function startTimer(){
            g_timer = setTimeout(function() {
                if (!evtFired) {
                    viewerBar.classList.remove(&quot;slideup&quot;)
                    viewerBar.classList.add(&apos;slidedown&apos;)  
                }
            }, 2000)
        }

        arrowUpMenu.addEventListener(&apos;mouseenter&apos;, () =&gt;{
            clearTimeout(g_timer)
            viewerBar.classList.remove(&quot;slidedown&quot;)
            viewerBar.classList.add(&apos;slideup&apos;)   
        })
        viewerBar.addEventListener(&apos;mouseleave&apos;, () =&gt;{
            evtFired = false
            viewerBar.classList.remove(&quot;slideup&quot;)
            viewerBar.classList.add(&apos;slidedown&apos;)   
        })
        viewerBar.addEventListener(&apos;mouseenter&apos;, () =&gt;{
            evtFired = true
            viewerBar.classList.remove(&quot;slidedown&quot;)
            viewerBar.classList.add(&apos;slideup&apos;)   
        })
        arrowUpMenu.addEventListener(&apos;mouseleave&apos;, () =&gt;{
            startTimer()
        })

        //Creates initial grid
        this.grid1= this.makeGrid()
    }
    
    /**
     * Creates the checkbox hidden menu when viewer is active
     */ 
    checkBoxes(){
        let viewerBar = document.querySelector(&apos;#viewer_bar&apos;)   
        viewerBar.classList.add(&apos;slidedown&apos;)

        //Grid display html element
        var gridDiv = document.createElement(&apos;div&apos;)
        viewerBar.appendChild(gridDiv)
        gridDiv.setAttribute(&apos;id&apos;, &apos;gridDiv&apos;)
        var gridCheck = document.createElement(&apos;input&apos;)
        gridDiv.appendChild(gridCheck)
        gridCheck.setAttribute(&apos;type&apos;, &apos;checkbox&apos;)
        gridCheck.setAttribute(&apos;id&apos;, &apos;gridCheck&apos;)
        gridDiv.setAttribute(&apos;style&apos;, &apos;float:right;&apos;)
               
        if (this.displayGrid){
            gridCheck.setAttribute(&apos;checked&apos;, &apos;true&apos;)
        }

        var gridCheckLabel = document.createElement(&apos;label&apos;)
        gridDiv.appendChild(gridCheckLabel)
        gridCheckLabel.setAttribute(&apos;for&apos;, &apos;gridCheck&apos;)
        gridCheckLabel.setAttribute(&apos;style&apos;, &apos;margin-right:1em;&apos;)
        gridCheckLabel.textContent= &quot;Grid&quot;
        gridCheckLabel.setAttribute(&apos;style&apos;, &apos;user-select: none;&apos;)


        gridCheck.addEventListener(&apos;change&apos;, event =&gt; {
            if(event.target.checked){
                this.scene.add( this.grid1 )
                this.displayGrid = true

            }
            else{
                this.scene.remove(this.grid1)
                this.displayGrid = false
            }
        })

        //Axes Html

        var axesDiv = document.createElement(&apos;div&apos;)
        viewerBar.appendChild(axesDiv)
        var axesCheck = document.createElement(&apos;input&apos;)
        axesDiv.appendChild(axesCheck)
        axesCheck.setAttribute(&apos;type&apos;, &apos;checkbox&apos;)
        axesCheck.setAttribute(&apos;id&apos;, &apos;axesCheck&apos;)
                
        if (this.axesCheck){
            axesCheck.setAttribute(&apos;checked&apos;, &apos;true&apos;)
        }

        var axesCheckLabel = document.createElement(&apos;label&apos;)
        axesDiv.appendChild(axesCheckLabel)
        axesCheckLabel.setAttribute(&apos;for&apos;, &apos;axesCheck&apos;)
        axesCheckLabel.setAttribute(&apos;style&apos;, &apos;margin-right:1em;&apos;)
        axesDiv.setAttribute(&apos;style&apos;, &apos;float:right;&apos;)
        axesCheckLabel.textContent= &quot;Axes&quot;
        axesCheckLabel.setAttribute(&apos;style&apos;, &apos;user-select: none;&apos;)

        axesCheck.addEventListener(&apos;change&apos;, event =&gt; {
            if(event.target.checked){
                this.scene.add( this.axesHelper)
                this.axesCheck = true
            }
            else{
                this.scene.remove( this.axesHelper)
                this.axesCheck = false
            }
        })

        //Solid HTML element

        var solidDiv = document.createElement(&apos;div&apos;)
        viewerBar.appendChild(solidDiv)
        solidDiv.setAttribute(&apos;id&apos;, &apos;solidDiv&apos;)
        var solidCheck = document.createElement(&apos;input&apos;)
        solidDiv.appendChild(solidCheck)
        solidCheck.setAttribute(&apos;type&apos;, &apos;checkbox&apos;)
        solidCheck.setAttribute(&apos;id&apos;, &apos;solidCheck&apos;)
               
        if (this.solidDisplay){
            solidCheck.setAttribute(&apos;checked&apos;, &apos;true&apos;)
            this.threeMaterial.solid = true
        }
        //solidCheck.setAttribute(&apos;checked&apos;, false)
        var solidCheckLabel = document.createElement(&apos;label&apos;)
        solidDiv.appendChild(solidCheckLabel)
        solidCheckLabel.setAttribute(&apos;for&apos;, &apos;solidCheck&apos;)
        //solidCheckLabel.setAttribute(&apos;style&apos;, &apos;margin-right:10em;&apos;)
        solidDiv.setAttribute(&apos;style&apos;, &apos;float:right;&apos;)
        solidCheckLabel.textContent= &quot;Solid&quot;
        solidCheckLabel.setAttribute(&apos;style&apos;, &apos;user-select: none;&apos;)

        solidCheck.addEventListener(&apos;change&apos;, event =&gt; {
            if( event.target.checked){
                this.solidDisplay = true
            }
            else{
                this.solidDisplay = false
            }
            this.writeToDisplay(this.displayedGeometry)
        })

    
        //Wireframe HTML element

        var wireDiv = document.createElement(&apos;div&apos;)
        viewerBar.appendChild(wireDiv)
        wireDiv.setAttribute(&apos;id&apos;, &apos;wireDiv&apos;)
        var wireCheck = document.createElement(&apos;input&apos;)
        wireDiv.appendChild(wireCheck)
        wireCheck.setAttribute(&apos;type&apos;, &apos;checkbox&apos;)
        wireCheck.setAttribute(&apos;id&apos;, &apos;wireCheck&apos;)
               
        if (this.wireDisplay){
            wireCheck.setAttribute(&apos;checked&apos;, &apos;true&apos;)
        }
        //wireCheck.setAttribute(&apos;checked&apos;, false)
        var wireCheckLabel = document.createElement(&apos;label&apos;)
        wireDiv.appendChild(wireCheckLabel)
        wireCheckLabel.setAttribute(&apos;for&apos;, &apos;wireCheck&apos;)
        //wireCheckLabel.setAttribute(&apos;style&apos;, &apos;margin-right:10em;&apos;)
        wireDiv.setAttribute(&apos;style&apos;, &apos;float:right;&apos;)
        wireCheckLabel.textContent= &quot;Wireframe&quot;
        wireCheckLabel.setAttribute(&apos;style&apos;, &apos;user-select: none;&apos;)

        wireCheck.addEventListener(&apos;change&apos;, event =&gt; {
            if( event.target.checked){
                this.wireDisplay = true
            }
            else{
                this.wireDisplay = false
            }
            this.writeToDisplay(this.displayedGeometry)
        })
    }
    
    /**
     * This function is intended to calculate the base log of two numbers and round it to an integer
     * @param {number,number}
     */ 
    baseLog(x,y){
        let baseLog = (Math.round(Math.log(x)/Math.log(y)))
        return baseLog
    }

    /**
     * This function is intended to calculate the 3d distance between object and camera
     * @param {number}
     */ 
    dist3D(position){
        const distance3D = Math.sqrt(Math.pow(position.x,2)
                         + Math.pow(position.y,2)
                         + Math.pow(position.z,2))
        return distance3D
    }
   
    /**
     * This function is intended to allow for materials. It is currently not used and can probably be deleted.
     * @param {object} material - A string to define the material type.
     */ 
    makeMaterial(material){
        switch (material) {
        case &apos;metal&apos;:
            return new THREE.MeshStandardMaterial({
                color: 0x779aac,
                emissive: 0x7090a0,
                roughness: 0.65,
                metalness: 0.99,
            })
        default:
            return new THREE.MeshNormalMaterial()
        }
    }
    
    /**
     * Writes a shape to the 3D display. Expecting a threejs geometry.
     * @param {object} shape - A jsxcad geometry data set to write to the display. Computation is done in a worker thread
     */ 
    writeToDisplay(shape){
        this.displayedGeometry = shape
        const computeValue = async () =&gt; {
            try {
                return await GlobalVariables.render({values: [shape, this.solidDisplay, this.wireDisplay], key: &quot;render&quot;})
            } catch(err) {
                console.warn(err)
                return -1
            }
        }

        computeValue().then(result =&gt; {
            this.updateDisplayData(result)
        })
    }
    
    /**
     * Zooms the camera to fit target bounds on the screen.
     * @param {array} bounds - An array of some sort...this comment should be updated.
     */ 
    zoomCameraToFit(bounds){

        this.controls.reset()
        this.camera.position.x = 0
        this.camera.position.y = -5*Math.max(...bounds[1])
        this.camera.position.z = 5*Math.max(...bounds[1])

        this.setGrid()  
    }

    /**
    * Scales grid if object loaded is already zoomed out farther than initial grid tier or if zoomed in or out
    */ 
    setGrid(){

        this.gridLevel = Math.log10(.01 * this.dist3D(this.camera.position))
        this.gridScale = Math.pow(10, Math.floor(this.gridLevel))
        this.grid1.scale.setScalar(this.gridScale)
        this.grid1.material.opacity = .01 
    }

    /**
     * Redraws the grid with update values on render
     */ 
    makeGrid() {
       
        var size = 1000
        var divisions = 100
        var grid = new THREE.GridHelper( size, divisions )
        grid.geometry.rotateX( Math.PI / 2 )
        this.scene.add(grid) 
        return grid
    }

    /**
     * Removes the grid with update values on checked box
     */ 
    removeGrid(grid) {
        this.scene.remove(grid) 
    }

    /**
     * Converts the tag to an RGB value.
     */ 
    toRgb(tags = [], defaultRgb = [0, 0, 0]){
        let rgb = defaultRgb
        for (const tag of tags) {
            if (tag.startsWith(&apos;color/&apos;)) {
                let entry = this.colorToRgbMapping[tag.substring(6)]
                if (entry !== undefined) {
                    rgb = entry
                }
            }
        }
        return rgb
    }
    
    /**
     * Sets the the color of the threejs mesh.
     */ 
    setColor(tags = [], parameters = {}, otherwise = [0, 0, 0]){
        let rgb = this.toRgb(tags, null)
        if (rgb === null) {
            rgb = otherwise
        }
        if (rgb === null) {
            return
        }
        const [r, g, b] = rgb
        
        const color = new THREE.Color( r, g, b ) // create a new color for conversion
        parameters.color = color.getHex()//color.getHexString(); // &quot;c08000&quot;
        return parameters
    }
    
    /**
     * Merges two objects.
     */ 
    merge(properties, parameters){
        for (const key of Object.keys(properties)) {
            parameters[key] = properties[key]
        }
    }
    
    /**
     * Sets the material properties of the threejs material.
     */ 
    setMaterial(tags, parameters){
        for (const tag of tags) {
            if (tag.startsWith(&apos;material/&apos;)) {
                const material = tag.substring(9)
                const properties = this.materialProperties[material]
                if (properties !== undefined) {
                    this.merge(properties, parameters)
                }
            }
        }
    }
    
    /**
     * Constructs a new threejs mesh material based on the properties in the tags.
     */ 
    buildMeshMaterial(tags){
        if (tags !== undefined) {
            const parameters = {}
            this.setColor(tags, parameters, null)
            this.setMaterial(tags, parameters)
            if (Object.keys(parameters).length &gt; 0) {
                return new THREE.MeshPhysicalMaterial(parameters)
            }
        }

        // Else, default to normal material.
        return this.threeMaterial
    }
    
    /**
     * Clears the display and writes a threejs geometry to it.
     * @param {object} threejsGeometry - A threejs geometry to write to the display. Generated from the worker thread.
     */ 
    updateDisplayData(threejsGeometry){
        // Delete any previous dataset in the window.
        for (const { mesh } of this.datasets) {
            this.scene.remove(mesh)
        }
        
        // Build new datasets from the written data, and display them.
        this.datasets = []

        //This walks through the geometry building a threejs geometry out of it
        const walk = (geometry) =&gt; {
            const { tags } = geometry
            if (geometry.assembly) {
                geometry.assembly.forEach(walk)
            } else if (geometry.item) {
                walk(geometry.item)
            } else if (geometry.threejsSegments) {
                const segments = geometry.threejsSegments
                const dataset = {}
                const threejsGeometry = new THREE.Geometry()
                for (const [[aX, aY, aZ], [bX, bY, bZ]] of segments) {
                    threejsGeometry.vertices.push(new THREE.Vector3(aX, aY, aZ), new THREE.Vector3(bX, bY, bZ))
                }
                dataset.mesh = new THREE.LineSegments(threejsGeometry, this.buildMeshMaterial(tags))
                this.scene.add(dataset.mesh)
                this.datasets.push(dataset)
            } else if (geometry.threejsSolid) {
                const { positions, normals } = geometry.threejsSolid
                const dataset = {}
                const threejsGeometry = new THREE.BufferGeometry()
                threejsGeometry.addAttribute(&apos;position&apos;, new THREE.Float32BufferAttribute(positions, 3))
                threejsGeometry.addAttribute(&apos;normal&apos;, new THREE.Float32BufferAttribute(normals, 3))
                dataset.mesh = new THREE.Mesh(threejsGeometry, this.buildMeshMaterial(tags))
                this.scene.add(dataset.mesh)
                this.datasets.push(dataset)
            } else if (geometry.threejsSurface) {
                const { positions, normals } = geometry.threejsSurface
                const dataset = {}
                const threejsGeometry = new THREE.BufferGeometry()
                threejsGeometry.addAttribute(&apos;position&apos;, new THREE.Float32BufferAttribute(positions, 3))
                threejsGeometry.addAttribute(&apos;normal&apos;, new THREE.Float32BufferAttribute(normals, 3))
                dataset.mesh = new THREE.Mesh(threejsGeometry, this.buildMeshMaterial(tags))
                this.scene.add(dataset.mesh)
                this.datasets.push(dataset)
            } else if (geometry.threejsPlan){
                walk(geometry.threejsVisualization)
                walk(geometry.threejsContent)
            }
        }
        walk(threejsGeometry)
    }
    
    /**
     * Handles resizing the 3D viewer when the window resizes.
     */ 
    onWindowResize() {
        this.camera.aspect = this.targetDiv.clientWidth / (this.targetDiv.clientHeight)
        this.camera.updateProjectionMatrix()
        this.controls.handleResize()
        this.renderer.setSize(this.targetDiv.clientWidth, this.targetDiv.clientHeight)
    }
    
    /**
     * Runs regularly to update the display.
     */ 
    render() {  

        this.renderer.render( this.scene, this.camera )
    }
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
